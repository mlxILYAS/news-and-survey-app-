{% extends 'base.html' %}

{% block title %}Home{% endblock %}

{% block back_button %}{% endblock %}

{% block content %}


	<!-- Quick Stats -->


	<!-- Latest News Section -->
	<div class="d-flex justify-content-between align-items-center mb-4">
		<h2 class="fw-bold">
			<i class="fas fa-newspaper me-2 text-primary"></i>Latest News
		</h2>
		{% if user.is_authenticated %}
			{% if user.is_superuser %}
				<a class="btn btn-outline-warning me-2" href="{% url 'news:superuser_dashboard' %}">
					<i class="fas fa-tachometer-alt me-1"></i>Admin Dashboard
				</a>
				<a class="btn btn-outline-info me-2" href="{% url 'news:survey_create' %}">
					<i class="fas fa-poll me-1"></i>Create Survey
				</a>
				<a class="btn btn-outline-primary" href="{% url 'news:article_create' %}">
					<i class="fas fa-plus me-1"></i>Create Article
				</a>
			{% endif %}
		{% endif %}
	</div>
	
	<div class="row">
		{% for article in articles %}
			<div class="col-md-6 col-lg-4 mb-4">
				<div class="flip-card">
					{% if article.slug %}
						{% if article.image %}
							<a href="{% url 'news:article_detail' article.slug %}" class="flip-cover" style="background-image: url('{{ article.image.url }}');"></a>
						{% else %}
							<a href="{% url 'news:article_detail' article.slug %}" class="flip-cover" style="background-image: linear-gradient(135deg,#3a3a3a,#1a1a1a);"></a>
						{% endif %}
					{% else %}
						{% if article.image %}
							<span class="flip-cover" style="background-image: url('{{ article.image.url }}');"></span>
						{% else %}
							<span class="flip-cover" style="background-image: linear-gradient(135deg,#3a3a3a,#1a1a1a);"></span>
						{% endif %}
					{% endif %}

					<div class="flip-content">
						<div class="flip-chip">
							<i class="fas fa-bookmark text-danger"></i>
							{{ article.category|default:"Magazine" }}
						</div>
						<h3 class="flip-title">{{ article.title }}</h3>
						<div class="flip-sub">
							<i class="fas fa-user me-1"></i>Curated by {{ article.author }}
							<span class="ms-2"><i class="fas fa-calendar-alt me-1"></i>{{ article.published_at|date:'M d, Y' }}</span>
						</div>
					</div>

					<div class="flip-actions">
						<div class="d-flex align-items-center gap-3">
							<i class="far fa-heart flip-icon"></i>
							<i class="far fa-comment flip-icon"></i>
							<i class="fas fa-plus flip-icon"></i>
						</div>
						<div class="d-flex align-items-center gap-2">
							<i class="fas fa-eye flip-icon muted"></i>
							<small class="text-white-50">{{ article.views|default:0 }}</small>
							<i class="fas fa-share-alt flip-icon"></i>
						</div>
					</div>
				</div>
			</div>
		{% empty %}
			<div class="col-12">
				<div class="text-center py-5">
					<div class="card border-0 bg-light">
						<div class="card-body py-5">
							<i class="fas fa-newspaper fa-4x text-muted mb-4"></i>
							<h3 class="text-muted mb-3">No Articles Yet</h3>
							<p class="text-muted mb-4">Be the first to share some exciting news with the community!</p>
							{% if user.is_authenticated %}
								<a href="{% url 'news:article_create' %}" class="btn btn-primary btn-lg">
									<i class="fas fa-plus me-2"></i>Create First Article
								</a>
							{% endif %}
						</div>
					</div>
				</div>
			</div>
		{% endfor %}
	</div>

	{% if not user.is_authenticated and most_visited %}
		<div class="d-flex justify-content-between align-items-center mb-4 mt-5">
			<h2 class="fw-bold">
				<i class="fas fa-fire me-2 text-danger"></i>Most Visited
			</h2>
		</div>

		<div class="row">
			{% for article in most_visited %}
				<div class="col-md-6 col-lg-4 mb-4">
					<div class="flip-card">
						{% if article.slug %}
							{% if article.image %}
								<a href="{% url 'news:article_detail' article.slug %}" class="flip-cover" style="background-image: url('{{ article.image.url }}');"></a>
							{% else %}
								<a href="{% url 'news:article_detail' article.slug %}" class="flip-cover" style="background-image: linear-gradient(135deg,#3a3a3a,#1a1a1a);"></a>
							{% endif %}
						{% else %}
							{% if article.image %}
								<span class="flip-cover" style="background-image: url('{{ article.image.url }}');"></span>
							{% else %}
								<span class="flip-cover" style="background-image: linear-gradient(135deg,#3a3a3a,#1a1a1a);"></span>
							{% endif %}
						{% endif %}

						<div class="flip-content">
							<div class="flip-chip">
								<i class="fas fa-bookmark text-danger"></i>
								{{ article.category|default:"Magazine" }}
							</div>
							<h3 class="flip-title">{{ article.title }}</h3>
							<div class="flip-sub">
								<i class="fas fa-user me-1"></i>Curated by {{ article.author }}
								<span class="ms-2"><i class="fas fa-calendar-alt me-1"></i>{{ article.published_at|date:'M d, Y' }}</span>
							</div>
						</div>

						<div class="flip-actions">
							<div class="d-flex align-items-center gap-3">
								<i class="far fa-heart flip-icon"></i>
								<i class="far fa-comment flip-icon"></i>
								<i class="fas fa-plus flip-icon"></i>
							</div>
							<div class="d-flex align-items-center gap-2">
								<i class="fas fa-eye flip-icon muted"></i>
								<small class="text-white-50">{{ article.views|default:0 }}</small>
								<i class="fas fa-share-alt flip-icon"></i>
							</div>
						</div>
					</div>
				</div>
			{% empty %}
				<div class="col-12">
					<div class="text-center py-4">
						<span class="text-muted">No popular articles yet.</span>
					</div>
				</div>
			{% endfor %}
		</div>
	{% endif %}

	<!-- Surveys Section for VIP Users and Superusers -->
	{% if user.is_authenticated and user.profile.is_vip and not user.is_superuser and surveys %}
		<div class="d-flex justify-content-between align-items-center mb-4 mt-5">
			<h2 class="fw-bold">
				<i class="fas fa-poll me-2 text-info"></i>Available Surveys
			</h2>
		</div>

		<div class="row">
			{% for survey in surveys %}
				<div class="col-md-6 col-lg-4 mb-4">
					<div class="card h-100 shadow-sm border-0 survey-card" style="transition: transform 0.3s ease, box-shadow 0.3s ease;">
						<div class="card-header {% if survey.has_available_slot %}bg-gradient-success{% else %}bg-gradient-danger{% endif %} text-white">
							<h5 class="card-title mb-0 fw-bold">
								<i class="fas fa-poll me-2"></i>{{ survey.title }}
							</h5>
						</div>
						<div class="card-body d-flex flex-column">
							<p class="card-text text-muted">{{ survey.description|truncatechars:100 }}</p>

							<!-- Survey Stats -->
							<div class="row text-center mb-3">
								<div class="col-4">
									<div class="border rounded p-2 bg-light">
										<h6 class="mb-0 text-primary">{{ survey.max_slots }}</h6>
										<small class="text-muted">Slots</small>
									</div>
								</div>
								<div class="col-4">
									<div class="border rounded p-2 bg-light">
										<h6 class="mb-0 text-success">{{ survey.available_slots }}</h6>
										<small class="text-muted">Available</small>
									</div>
								</div>
								<div class="col-4">
									<div class="border rounded p-2 bg-light">
										<h6 class="mb-0 text-warning">{{ survey.questions.count }}</h6>
										<small class="text-muted">Questions</small>
									</div>
								</div>
							</div>

							<!-- Status Badge -->
							{% if survey.has_available_slot %}
								<span class="badge bg-success mb-3">
									<i class="fas fa-check-circle me-1"></i>Available
								</span>
							{% else %}
								<span class="badge bg-danger mb-3">
									<i class="fas fa-times-circle me-1"></i>No Slots Left
								</span>
							{% endif %}

							<div class="d-flex justify-content-between align-items-center mt-auto">
								<small class="text-muted">
									<i class="fas fa-clock me-1"></i>{{ survey.slot_duration_hours }}h slots
								</small>
								<small class="text-muted">
									<i class="fas fa-calendar me-1"></i>{{ survey.created_at|date:'M d, Y' }}
								</small>
							</div>
						</div>
						<div class="card-footer bg-light">
							{% if survey.has_available_slot %}
								<a href="{% url 'news:survey_detail' survey.pk %}" class="btn btn-success w-100">
									<i class="fas fa-play me-1"></i>Take Survey
								</a>
							{% else %}
								<span class="text-muted text-center w-100">No slots available</span>
							{% endif %}
						</div>
					</div>
				</div>
			{% endfor %}
		</div>
	{% elif user.is_authenticated and user.is_superuser and surveys %}
		<div class="d-flex justify-content-between align-items-center mb-4 mt-5">
			<h2 class="fw-bold">
				<i class="fas fa-poll me-2 text-info"></i>Recent Surveys
			</h2>
			<a class="btn btn-outline-info" href="{% url 'news:survey_list' %}">
				<i class="fas fa-list me-1"></i>View All Surveys
			</a>
		</div>

		<div class="row">
			{% for survey in surveys %}
				<div class="col-md-6 col-lg-4 mb-4">
					<div class="card h-100 shadow-sm border-0 survey-card" style="transition: transform 0.3s ease, box-shadow 0.3s ease;">
						<div class="card-header {% if survey.has_available_slot %}bg-gradient-success{% else %}bg-gradient-danger{% endif %} text-white">
							<h5 class="card-title mb-0 fw-bold">
								<i class="fas fa-poll me-2"></i>{{ survey.title }}
							</h5>
						</div>
						<div class="card-body d-flex flex-column">
							<p class="card-text text-muted">{{ survey.description|truncatechars:100 }}</p>

							<!-- Survey Stats -->
							<div class="row text-center mb-3">
								<div class="col-4">
									<div class="border rounded p-2 bg-light">
										<h6 class="mb-0 text-primary">{{ survey.max_slots }}</h6>
										<small class="text-muted">Slots</small>
									</div>
								</div>
								<div class="col-4">
									<div class="border rounded p-2 bg-light">
										<h6 class="mb-0 text-success">{{ survey.available_slots }}</h6>
										<small class="text-muted">Available</small>
									</div>
								</div>
								<div class="col-4">
									<div class="border rounded p-2 bg-light">
										<h6 class="mb-0 text-warning">{{ survey.questions.count }}</h6>
										<small class="text-muted">Questions</small>
									</div>
								</div>
							</div>

							<!-- Status Badge -->
							{% if survey.has_available_slot %}
								<span class="badge bg-success mb-3">
									<i class="fas fa-check-circle me-1"></i>Active
								</span>
							{% else %}
								<span class="badge bg-danger mb-3">
									<i class="fas fa-times-circle me-1"></i>Full
								</span>
							{% endif %}

							<div class="d-flex justify-content-between align-items-center mt-auto">
								<small class="text-muted">
									<i class="fas fa-clock me-1"></i>{{ survey.slot_duration_hours }}h slots
								</small>
								<small class="text-muted">
									<i class="fas fa-calendar me-1"></i>{{ survey.created_at|date:'M d, Y' }}
								</small>
							</div>
						</div>
						<div class="card-footer bg-light">
							<div class="d-flex gap-1">
								<a href="{% url 'news:survey_edit' survey.pk %}" class="btn btn-primary btn-sm">
									<i class="fas fa-edit"></i>
								</a>
								<a href="{% url 'news:survey_detail' survey.pk %}" class="btn btn-info btn-sm">
									<i class="fas fa-eye"></i>
								</a>
								<a href="{% url 'news:survey_delete' survey.pk %}" class="btn btn-danger btn-sm"
									onclick="return confirm('Delete this survey? This will also delete all responses!')">
									<i class="fas fa-trash"></i>
								</a>
							</div>
						</div>
					</div>
				</div>
			{% endfor %}
		</div>
	{% endif %}

{% endblock %}
